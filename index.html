<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Map</title>
    <!-- External Stylesheets -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"/>
    <!-- Add the Leaflet JavaScript library -->
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
    <!-- Add UTM to Leaflet -->
    <script src="https://jjimenezshaw.github.io/Leaflet.UTM/L.LatLng.UTM.js"></script>
    <!-- Awesome Font -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/leaflet-sidebar.css" />
    <!-- Custom leaflet icon and visuals-->
    <script src="js/customLeaflet.js"></script>
    <!-- Photogrammetry Equations-->
    <script src="js/photogrammetry.js"></script>

</head>
<body>
// div to hold the sidebar
<div id="sidebar" class="sidebar collapsed">
    <!-- Nav tabs -->
    <div class="sidebar-tabs">
        <ul role="tablist">
            <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
            <li><a href="#profile" role="tab"><i class="fa fa-user"></i></a></li>
            <li class="disabled"><a href="#messages" role="tab"><i class="fa fa-envelope"></i></a></li>
            <li><a href="https://github.com/Turbo87/sidebar-v2" role="tab" target="_blank"><i class="fa fa-github"></i></a></li>
        </ul>

        <ul role="tablist">
            <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
        </ul>
    </div>

    <!-- Tab panes -->
    <div class="sidebar-content">
        <div class="sidebar-pane" id="home">
            <h1 class="sidebar-header">
                sidebar-v2
                <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
            </h1>

            <p>A responsive sidebar for mapping libraries like <a href="http://leafletjs.com/">Leaflet</a> or <a href="http://openlayers.org/">OpenLayers</a>.</p>

            <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

            <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

            <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>

            <p class="lorem">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</p>
        </div>

        <div class="sidebar-pane" id="profile">
            <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
        </div>

        <div class="sidebar-pane" id="messages">
            <h1 class="sidebar-header">Messages<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
        </div>

        <div class="sidebar-pane" id="settings">
            <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
        </div>
    </div>
</div>

// div to hold the map
<div id="mapid" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0;"></div>

<script src="js/leaflet-sidebar.js"></script>

<script>

    // Create variable to hold map element, give initial settings to map
    var mymap = L.map('mapid', {
        center: [44.56576, -123.27888],
        zoom: 16
    });
    var sidebar = L.control.sidebar('sidebar').addTo(mymap);

    // Add OpenStreetMap tile layer to map element
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(mymap);

    // Create point feature for UAS
    var uasPoint = L.marker([44.56822, -123.28034],{icon: uasicon, draggable: true}).addTo(mymap);
    uasPoint.bindPopup("<h3>Wilkinson Hall</h3><p>Corvallis, Oregon<br>College of Earth, Ocean, and Atmostpheric Sciences</p>");

    // create EO, IO, and Camera
    function reDrawOrtho() {
        var myIO = new IO(4000, 4000, 3000);
        var Xc = uasPoint.getLatLng().utm().x;
        var Yc = uasPoint.getLatLng().utm().y;
        var Zc = 1000;
        var roll = 15 * Math.PI/180;
        var pitch = 160 * Math.PI / 180;
        var yaw = 225 * Math.PI/180;
        var myEO = new EO(Xc, Yc, Zc, roll, pitch, yaw);
        var myCamera = new Camera(myIO, myEO);
        var newXY = myCamera.calcSpaceIntersection(2000, 1500);
        console.debug(newXY);
        var newPt = L.utm({
            x: newXY[0],
            y: newXY[1],
            zone: uasPoint.getLatLng().utm().zone,
            band: uasPoint.getLatLng().utm().band
        });
        var newMarker = L.marker([newPt.latLng().lat, newPt.latLng().lng]).addTo(mymap);

        var box1 = L.utm({
            x: myCamera.calcSpaceIntersection(1, 1)[0],
            y: myCamera.calcSpaceIntersection(1, 1)[1],
            zone: uasPoint.getLatLng().utm().zone,
            band: uasPoint.getLatLng().utm().band
        });
        var box2 = L.utm({
            x: myCamera.calcSpaceIntersection(1, 3000)[0],
            y: myCamera.calcSpaceIntersection(1, 3000)[1],
            zone: uasPoint.getLatLng().utm().zone,
            band: uasPoint.getLatLng().utm().band
        });
        var box3 = L.utm({
            x: myCamera.calcSpaceIntersection(4000, 3000)[0],
            y: myCamera.calcSpaceIntersection(4000, 3000)[1],
            zone: uasPoint.getLatLng().utm().zone,
            band: uasPoint.getLatLng().utm().band
        });
        var box4 = L.utm({
            x: myCamera.calcSpaceIntersection(4000, 1)[0],
            y: myCamera.calcSpaceIntersection(4000, 1)[1],
            zone: uasPoint.getLatLng().utm().zone,
            band: uasPoint.getLatLng().utm().band
        });

        // Create area feature for Strand Ag Hall, style and add to map
        var myArea = L.polygon([
            [box1.latLng().lat, box1.latLng().lng],
            [box2.latLng().lat, box2.latLng().lng],
            [box3.latLng().lat, box3.latLng().lng],
            [box4.latLng().lat, box4.latLng().lng]
        ], {
            color: 'orange',
            weight: 5
        }).addTo(mymap);
    }
    // Create an Empty Popup
    var popup = L.popup();

    // Write function to set Properties of the Popup
    function onMapClick(e) {
        popup
            .setLatLng(e.latlng)
            .setContent("You clicked the map at " + e.latlng.toString())
            .openOn(mymap);
    }
    reDrawOrtho();
    // Listen for a click event on the Map element
    mymap.on('click', onMapClick);
    uasPoint.on('dragend',reDrawOrtho);
</script>
</body>
</html>